<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MoviTube - Genres</title>

    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Bootstrap Icons -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.7.2/font/bootstrap-icons.css" rel="stylesheet">
    <!-- Bootstrap JavaScript -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    
    <style>
        :root {
            --primary-dark: #273043;
            --primary-purple: #9197AE;
            --off-white: #EFF6EE;
            --accent-red: #F02D3A;
            --dark-red: #DD0426;
        }
        
        body {
            background-color: var(--primary-dark);
            color: var(--off-white);
        }
        
        .navbar {
            background-color: var(--primary-dark) !important;
            padding-top: 0.8rem;
            padding-bottom: 0.8rem;
        }
        
        .navbar-brand {
            color: var(--off-white) !important;
            font-weight: bold;
            font-size: 1.8rem;
        }
        
        .navbar-nav .nav-link {
            color: var(--off-white) !important;
        }
        
        .navbar-nav .nav-link:hover {
            color: var(--accent-red) !important;
        }
        
        .btn-primary {
            background-color: var(--accent-red);
            border-color: var(--dark-red);
        }
        
        .btn-primary:hover {
            background-color: var(--dark-red);
            border-color: var(--dark-red);
        }
        
        .card {
            border: 1px solid var(--primary-purple);
            background-color: #1f2633; 
            box-shadow: 0 4px 6px rgba(0,0,0,0.2);
        }
        
        .card-title { color: var(--off-white); }
        .card-text { color: var(--primary-purple); }
        .text-muted { color: var(--primary-purple) !important; }
        
        .card-header {
            background-color: var(--primary-purple);
            color: white;
            border: none;
        }
        
        .section-title {
            color: var(--off-white);
            border-bottom: 2px solid var(--accent-red);
            padding-bottom: 10px;
            margin-bottom: 2rem;
        }
    </style>
</head>

<body>
    <!-- Bootstrap Navbar -->
    <nav class="navbar navbar-expand-lg navbar-dark">
        <div class="container">
            <a class="navbar-brand" href="Homepage.html">
                <i class="bi bi-film"></i> MoviTube
            </a>
            
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                <span class="navbar-toggler-icon"></span>
            </button>
            
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav me-auto">
                    <li class="nav-item">
                        <a class="nav-link" href="Genres Page.html">Genres</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="Watchlist Page.html">Watchlist</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="Contact Page.html">Contact</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="About Us Page.html">About Us</a>
                    </li>
                </ul>
                
                <form class="d-flex" action="Search Results Page.html" method="GET">
                    <input class="form-control me-2" type="search" name="query" placeholder="Search Movies...">
                    <button class="btn btn-primary" type="submit">
                        <i class="bi bi-search"></i>
                    </button>
                </form>
            </div>
        </div>
    </nav>

    <!-- Genres Content -->
    <div class="container mt-4">
        <section id="genres">
            <h2 class="section-title text-center">Browse by Genre</h2>

            <!-- Pills navigation to jump to each genre section -->
            <div class="d-flex justify-content-center mb-4">
                <ul class="nav nav-pills flex-row" role="tablist">
                    <li class="nav-item me-2"><a class="nav-link active" href="#" data-genre="all">All</a></li>
                    <li class="nav-item me-2"><a class="nav-link" href="#" data-genre="action">Action</a></li>
                    <li class="nav-item me-2"><a class="nav-link" href="#" data-genre="comedy">Comedy</a></li>
                    <li class="nav-item me-2"><a class="nav-link" href="#" data-genre="drama">Drama</a></li>
                    <li class="nav-item me-2"><a class="nav-link" href="#" data-genre="scifi">Sci-Fi</a></li>
                    <li class="nav-item me-2"><a class="nav-link" href="#" data-genre="romance">Romance</a></li>
                    <li class="nav-item"><a class="nav-link" href="#" data-genre="horror">Horror</a></li>
                </ul>
            </div>

            <!-- Action Section -->
            <div id="action" class="mb-5">
                <h3>Action</h3>
                <div class="row">
                </div>
            </div>

            <!-- Comedy Section -->
            <div id="comedy" class="mb-5">
                <h3>Comedy</h3>
                <div class="row">
                </div>
            </div>

            <!-- Drama Section -->
            <div id="drama" class="mb-5">
                <h3>Drama</h3>
                <div class="row">
                </div>
            </div>

            <!-- Sci-Fi Section -->
            <div id="scifi" class="mb-5">
                <h3>Sci-Fi</h3>
                <div class="row">
                </div>
            </div>

            <!-- Romance Section -->
            <div id="romance" class="mb-5">
                <h3>Romance</h3>
                <div class="row">
                </div>
            </div>

            <!-- Horror Section -->
            <div id="horror" class="mb-5">
                <h3>Horror</h3>
                <div class="row">
                </div>
            </div>
        </section>
    </div>

    <!-- Footer -->
    <footer class="py-4 mt-5" style="border-top: 1px solid var(--primary-purple);">
        <div class="container">
            <div class="row">
                <div class="col-12 text-center">
                    <h5 style="color:var(--off-white)"><i class="bi bi-film"></i> MoviTube</h5>
                    <p class="mb-0" style="color:var(--primary-purple)">&copy; 2025 MoviTube. All rights reserved.</p>
                </div>
            </div>
        </div>
    </footer>
    
</footer>

    <!-- OMDb API integration -->
    <script>
    (() => {
      const API_KEY = "fd0ac2a4"; // OMDb API key
      const OMDB_BASE = "https://www.omdbapi.com/";

      // Helper function to escape HTML
      const esc = (s) =>
        String(s).replace(/[&<>\"']/g, (m) => ({
          "&": "&amp;",
          "<": "&lt;",
          ">": "&gt;",
          '"': "&quot;",
          "'": "&#39;"
        })[m]);

      // Search movies by query
      async function searchMovies(query, page = 1) {
        try {
          const url = `${OMDB_BASE}?apikey=${API_KEY}&s=${encodeURIComponent(query)}&type=movie&page=${page}`;
          const res = await fetch(url);
          const data = await res.json();
          return data.Response === "True" ? data.Search || [] : [];
        } catch (err) {
          console.error("Error searching movies:", err);
          return [];
        }
      }

      // Fetch movie details by IMDb ID
      async function fetchMovieById(imdbId) {
        try {
          const url = `${OMDB_BASE}?apikey=${API_KEY}&i=${imdbId}`;
          const res = await fetch(url);
          const data = await res.json();
          return data.Response === "True" ? data : null;
        } catch (err) {
          console.error("Error fetching movie:", err);
          return null;
        }
      }

      // Create movie card HTML
      function createMovieCard(movie) {
        const title = movie.Title || "Untitled";
        const year = movie.Year || "N/A";
        const rating = movie.imdbRating || "N/A";
        const poster = movie.Poster && movie.Poster !== "N/A" 
          ? movie.Poster 
          : "https://via.placeholder.com/300x450/273043/EFF6EE?text=No+Image";
        const imdbUrl = movie.imdbID ? `https://www.imdb.com/title/${movie.imdbID}/` : "#";

        return `
          <div class="col-sm-6 col-md-4 col-lg-3 mb-4">
            <div class="card h-100">
              <img src="${poster}" class="card-img-top" alt="${esc(title)}" style="height: 350px; object-fit: cover;">
              <div class="card-body">
                <h5 class="card-title">${esc(title)}</h5>
                <p class="card-text small text-muted">
                  Year: ${year}<br>
                  Rating: ${rating !== "N/A" ? "‚≠ê " + rating : "N/A"}
                </p>
                <a href="${imdbUrl}" target="_blank" class="btn btn-primary btn-sm">View on IMDb</a>
              </div>
            </div>
          </div>`;
      }

      // Loading placeholder
      function createLoadingCard() {
        return `
          <div class="col-sm-6 col-md-4 col-lg-3 mb-4">
            <div class="card h-100 placeholder-glow">
              <div class="ratio ratio-3x4 bg-secondary"></div>
              <div class="card-body">
                <h5 class="card-title"><span class="placeholder col-8"></span></h5>
                <p class="card-text"><span class="placeholder col-6"></span></p>
              </div>
            </div>
          </div>`;
      }

      // Load movies for a specific genre
      async function loadGenreMovies(genreId, searchQuery) {
        const genreSection = document.getElementById(genreId);
        if (!genreSection) return;

        const rowContainer = genreSection.querySelector('.row');
        if (!rowContainer) return;

        // Show loading state
        rowContainer.innerHTML = createLoadingCard().repeat(8);

        // Search for movies
        const movies = await searchMovies(searchQuery);
        
        if (movies.length === 0) {
          rowContainer.innerHTML = `
            <div class="col-12">
              <div class="alert alert-secondary" role="alert">
                No movies found for this genre.
              </div>
            </div>`;
          return;
        }

        // Fetch detailed info for each movie (to get ratings)
        const detailedMovies = await Promise.all(
          movies.slice(0, 8).map(m => fetchMovieById(m.imdbID))
        );

        const validMovies = detailedMovies.filter(m => m !== null);
        rowContainer.innerHTML = validMovies.map(createMovieCard).join('');

        // Re-attach watchlist functionality to new cards
        attachWatchlistButtons(genreSection);
      }

      // Watchlist functionality
      const STORAGE_KEY = 'moviTubeWatchlist';

      function loadWatchlist() {
        try {
          const raw = localStorage.getItem(STORAGE_KEY);
          return raw ? JSON.parse(raw) : [];
        } catch (e) {
          return [];
        }
      }

      function saveWatchlist(list) {
        try {
          localStorage.setItem(STORAGE_KEY, JSON.stringify(list));
        } catch (e) {
          console.warn('Could not save watchlist', e);
        }
      }

      function toggleWatchlist(title, btn) {
        const list = loadWatchlist();
        const idx = list.indexOf(title);
        if (idx >= 0) {
          list.splice(idx, 1);
          btn.textContent = 'Add to Watchlist';
          btn.classList.remove('btn-success');
          btn.classList.add('btn-outline-primary');
        } else {
          list.push(title);
          btn.textContent = 'Added';
          btn.classList.remove('btn-outline-primary');
          btn.classList.add('btn-success');
        }
        saveWatchlist(list);
      }

      function attachWatchlistButtons(container) {
        const cards = container.querySelectorAll('.card.h-100');
        const currentWatchlist = loadWatchlist();

        cards.forEach(card => {
          const titleEl = card.querySelector('.card-title');
          const title = titleEl ? titleEl.textContent.trim() : null;
          if (!title) return;

          // Don't add button if it already exists
          if (card.querySelector('.watchlist-btn')) return;

          const btn = document.createElement('button');
          btn.type = 'button';
          btn.className = 'btn btn-outline-primary btn-sm ms-2 watchlist-btn';
          btn.textContent = currentWatchlist.indexOf(title) !== -1 ? 'Added' : 'Add to Watchlist';
          if (currentWatchlist.indexOf(title) !== -1) {
            btn.classList.remove('btn-outline-primary');
            btn.classList.add('btn-success');
          }

          btn.addEventListener('click', (e) => {
            e.preventDefault();
            toggleWatchlist(title, btn);
          });

          const viewBtn = card.querySelector('a.btn.btn-primary');
          if (viewBtn) viewBtn.insertAdjacentElement('afterend', btn);
          else card.querySelector('.card-body').appendChild(btn);
        });
      }

      // Genre filter functionality
      function setupGenreFilter() {
        const pills = document.querySelectorAll('[data-genre]');
        const sections = document.querySelectorAll('#genres > div[id]');

        function showGenre(genre) {
          pills.forEach(p => {
            if (p.getAttribute('data-genre') === genre) p.classList.add('active');
            else p.classList.remove('active');
          });

          sections.forEach(sec => {
            if (genre === 'all') {
              sec.style.display = '';
            } else {
              if (sec.id === genre) sec.style.display = '';
              else sec.style.display = 'none';
            }
          });

          if (genre !== 'all') {
            const el = document.getElementById(genre);
            if (el) {
              const navbarHeight = document.querySelector('.navbar')?.offsetHeight || 0;
              const yOffset = -navbarHeight - 20;
              const y = el.getBoundingClientRect().top + window.pageYOffset + yOffset;
              window.scrollTo({top: y, behavior: 'smooth'});
            }
          } else {
            const navbarHeight = document.querySelector('.navbar')?.offsetHeight || 0;
            const genresEl = document.getElementById('genres');
            if (genresEl) {
              const yOffset = -navbarHeight - 20;
              const y = genresEl.getBoundingClientRect().top + window.pageYOffset + yOffset;
              window.scrollTo({top: y, behavior: 'smooth'});
            }
          }
        }

        pills.forEach(p => {
          p.addEventListener('click', (e) => {
            e.preventDefault();
            const genre = p.getAttribute('data-genre');
            showGenre(genre);
          });
        });

        showGenre('all');
      }

      // Initialize on page load
      document.addEventListener('DOMContentLoaded', async () => {
        // Set up genre filter
        setupGenreFilter();

        // Check if there's a hash in the URL and show that genre
        const hash = window.location.hash.substring(1); // Remove the '#'
        if (hash && ['action', 'comedy', 'drama', 'scifi', 'romance', 'horror'].includes(hash)) {
          // Wait a bit for the page to render, then trigger the genre filter
          setTimeout(() => {
            const genrePill = document.querySelector(`[data-genre="${hash}"]`);
            if (genrePill) {
              genrePill.click();
            }
          }, 500);
        }

        // Load movies for each genre
        const genres = [
          { id: 'action', query: 'action' },
          { id: 'comedy', query: 'comedy' },
          { id: 'drama', query: 'drama' },
          { id: 'scifi', query: 'science fiction' },
          { id: 'romance', query: 'romance' },
          { id: 'horror', query: 'horror' }
        ];

        // Load all genres in parallel
        await Promise.all(
          genres.map(genre => loadGenreMovies(genre.id, genre.query))
        );
      });
    })();
    </script>
</body>
</html>

